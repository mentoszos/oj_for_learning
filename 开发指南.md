# åç«¯å¼€å‘æŒ‡å—

> æ¬¢è¿åŠ å…¥ CodeCollab OJ åç«¯å¼€å‘å›¢é˜Ÿï¼æœ¬æ–‡æ¡£å°†å¸®åŠ©ä½ å¿«é€Ÿä¸Šæ‰‹é¡¹ç›®å¼€å‘ã€‚

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [ç¯å¢ƒå‡†å¤‡](#ç¯å¢ƒå‡†å¤‡)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [å¼€å‘æµç¨‹](#å¼€å‘æµç¨‹)
- [ä»£ç è§„èŒƒ](#ä»£ç è§„èŒƒ)
- [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
- [API æ¥å£è§„èŒƒ](#api-æ¥å£è§„èŒƒ)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

CodeCollab OJ æ˜¯ä¸€ä¸ªåœ¨çº¿å®æ—¶åä½œè¯„æµ‹ç³»ç»Ÿï¼Œåç«¯ä½¿ç”¨ Spring Boot 3.x + Java 17 å¼€å‘ã€‚

### æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Spring Boot 3.2.0
- **è¯­è¨€**: Java 17+
- **æ•°æ®åº“**: MySQL 8.0
- **ORM**: MyBatis Plus 3.5.5
- **ç¼“å­˜**: Redis
- **æ¶ˆæ¯é˜Ÿåˆ—**: RabbitMQ
- **å®æ—¶é€šä¿¡**: WebSocket (STOMP)
- **æ„å»ºå·¥å…·**: Maven

## ğŸ›  ç¯å¢ƒå‡†å¤‡

### 1. å®‰è£… JDK

ç¡®ä¿å·²å®‰è£… JDK 17 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼š

```bash
java -version  # åº”è¯¥ >= 17
```

### 2. å®‰è£… Maven

ç¡®ä¿å·²å®‰è£… Maven 3.6+ï¼š

```bash
mvn -version
```

### 3. å®‰è£…æ•°æ®åº“å’Œä¸­é—´ä»¶

#### MySQL 8.0

```bash
# åˆ›å»ºæ•°æ®åº“
CREATE DATABASE codecollab_oj CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# æ‰§è¡Œå»ºè¡¨è„šæœ¬
mysql -u root -p codecollab_oj < src/main/resources/db/schema.sql
```

#### Redis

```bash
# å¯åŠ¨ Redisï¼ˆé»˜è®¤ç«¯å£ 6379ï¼‰
redis-server
```

#### RabbitMQ

```bash
# å¯åŠ¨ RabbitMQï¼ˆé»˜è®¤ç«¯å£ 5672ï¼‰
rabbitmq-server
```

### 4. é…ç½®é¡¹ç›®

ä¿®æ”¹ `src/main/resources/application.yml`ï¼š

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/codecollab_oj?...
    username: root
    password: your_password
  
  data:
    redis:
      host: localhost
      port: 6379
  
  rabbitmq:
    host: localhost
    port: 5672
    username: guest
    password: guest
```

### 5. å¯åŠ¨é¡¹ç›®

```bash
cd backend
mvn spring-boot:run
```

æˆ–ä½¿ç”¨ IDE ç›´æ¥è¿è¡Œ `CodeCollabOjApplication.java`

## ğŸ“ é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ src/main/java/com/codecollab/oj/
â”‚   â”œâ”€â”€ CodeCollabOjApplication.java  # å¯åŠ¨ç±»
â”‚   â”œâ”€â”€ config/                        # é…ç½®ç±»
â”‚   â”‚   â”œâ”€â”€ WebSocketConfig.java       # WebSocket é…ç½®
â”‚   â”‚   â”œâ”€â”€ RabbitMQConfig.java        # RabbitMQ é…ç½®
â”‚   â”‚   â”œâ”€â”€ MyBatisPlusConfig.java     # MyBatis Plus é…ç½®
â”‚   â”‚   â””â”€â”€ CorsConfig.java            # è·¨åŸŸé…ç½®
â”‚   â”œâ”€â”€ controller/                    # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”œâ”€â”€ ProblemController.java     # é¢˜ç›®æ§åˆ¶å™¨
â”‚   â”‚   â””â”€â”€ SubmitController.java      # æäº¤æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ service/                       # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ QuestionService.java       # é¢˜ç›®æœåŠ¡æ¥å£
â”‚   â”‚   â”œâ”€â”€ JudgeService.java          # åˆ¤é¢˜æœåŠ¡æ¥å£
â”‚   â”‚   â””â”€â”€ impl/                      # æœåŠ¡å®ç°
â”‚   â”‚       â”œâ”€â”€ QuestionServiceImpl.java
â”‚   â”‚       â””â”€â”€ JudgeServiceImpl.java
â”‚   â”œâ”€â”€ mapper/                        # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ QuestionMapper.java
â”‚   â”‚   â””â”€â”€ QuestionSubmitMapper.java
â”‚   â”œâ”€â”€ model/                         # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ entity/                    # å®ä½“ç±»ï¼ˆå¯¹åº”æ•°æ®åº“è¡¨ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ Question.java
â”‚   â”‚   â”‚   â”œâ”€â”€ QuestionSubmit.java
â”‚   â”‚   â”‚   â””â”€â”€ InterviewRoom.java
â”‚   â”‚   â”œâ”€â”€ dto/                       # æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆè¯·æ±‚å‚æ•°ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ SubmitRequest.java
â”‚   â”‚   â”‚   â””â”€â”€ ProblemQueryRequest.java
â”‚   â”‚   â””â”€â”€ vo/                        # è§†å›¾å¯¹è±¡ï¼ˆå“åº”æ•°æ®ï¼‰
â”‚   â”‚       â”œâ”€â”€ ProblemVO.java
â”‚   â”‚       â””â”€â”€ SubmitResultVO.java
â”‚   â””â”€â”€ common/                        # é€šç”¨ç±»
â”‚       â””â”€â”€ BaseResponse.java          # ç»Ÿä¸€å“åº”ç±»
â””â”€â”€ src/main/resources/
    â”œâ”€â”€ application.yml                # é…ç½®æ–‡ä»¶
    â””â”€â”€ db/
        â””â”€â”€ schema.sql                 # æ•°æ®åº“å»ºè¡¨è„šæœ¬
```

## ğŸš€ å¼€å‘æµç¨‹

### 1. åˆ›å»ºæ–°åŠŸèƒ½æ¨¡å—

#### æ­¥éª¤ 1: åˆ›å»ºå®ä½“ç±»

```java
// src/main/java/com/codecollab/oj/model/entity/NewEntity.java
@Data
@TableName("new_table")
public class NewEntity {
    @TableId(type = IdType.AUTO)
    private Long id;
    
    private String name;
    
    @TableField(value = "create_time", fill = FieldFill.INSERT)
    private LocalDateTime createTime;
}
```

#### æ­¥éª¤ 2: åˆ›å»º Mapper

```java
// src/main/java/com/codecollab/oj/mapper/NewMapper.java
@Mapper
public interface NewMapper extends BaseMapper<NewEntity> {
}
```

#### æ­¥éª¤ 3: åˆ›å»º Service

```java
// src/main/java/com/codecollab/oj/service/NewService.java
public interface NewService {
    NewEntity getById(Long id);
}

// src/main/java/com/codecollab/oj/service/impl/NewServiceImpl.java
@Service
public class NewServiceImpl implements NewService {
    @Autowired
    private NewMapper newMapper;
    
    @Override
    public NewEntity getById(Long id) {
        return newMapper.selectById(id);
    }
}
```

#### æ­¥éª¤ 4: åˆ›å»º Controller

```java
// src/main/java/com/codecollab/oj/controller/NewController.java
@RestController
@RequestMapping("/api/new")
@CrossOrigin(origins = "*")
public class NewController {
    @Autowired
    private NewService newService;
    
    @GetMapping("/{id}")
    public BaseResponse<NewEntity> getById(@PathVariable Long id) {
        NewEntity entity = newService.getById(id);
        return BaseResponse.success(entity);
    }
}
```

### 2. æ•°æ®åº“æ“ä½œ

#### ä½¿ç”¨ MyBatis Plus

```java
// æŸ¥è¯¢
Question question = questionMapper.selectById(1L);

// æ¡ä»¶æŸ¥è¯¢
QueryWrapper<Question> wrapper = new QueryWrapper<>();
wrapper.eq("id", 1).eq("is_delete", 0);
Question question = questionMapper.selectOne(wrapper);

// æ’å…¥
Question question = new Question();
question.setTitle("æ–°é¢˜ç›®");
questionMapper.insert(question);

// æ›´æ–°
question.setTitle("ä¿®æ”¹åçš„æ ‡é¢˜");
questionMapper.updateById(question);

// åˆ é™¤ï¼ˆé€»è¾‘åˆ é™¤ï¼‰
questionMapper.deleteById(1L);
```

### 3. ä½¿ç”¨ Redis

```java
@Autowired
private RedisTemplate<String, Object> redisTemplate;

// è®¾ç½®
redisTemplate.opsForValue().set("key", "value", 60, TimeUnit.SECONDS);

// è·å–
String value = (String) redisTemplate.opsForValue().get("key");

// åˆ é™¤
redisTemplate.delete("key");
```

### 4. ä½¿ç”¨ RabbitMQ

```java
@Autowired
private RabbitTemplate rabbitTemplate;

// å‘é€æ¶ˆæ¯
rabbitTemplate.convertAndSend("queue_name", message);

// æ¥æ”¶æ¶ˆæ¯ï¼ˆåœ¨æ¶ˆè´¹è€…ä¸­ï¼‰
@RabbitListener(queues = "queue_name")
public void handleMessage(String message) {
    // å¤„ç†æ¶ˆæ¯
}
```

## ğŸ“ ä»£ç è§„èŒƒ

### 1. å‘½åè§„èŒƒ

- **ç±»å**: PascalCaseï¼Œå¦‚ `QuestionService`
- **æ–¹æ³•å**: camelCaseï¼Œå¦‚ `getProblemById`
- **å¸¸é‡**: UPPER_SNAKE_CASEï¼Œå¦‚ `MAX_SIZE`
- **åŒ…å**: å°å†™ï¼Œå¦‚ `com.codecollab.oj.service`

### 2. ä»£ç ç»„ç»‡

```java
@RestController
@RequestMapping("/api/example")
public class ExampleController {
    
    // 1. ä¾èµ–æ³¨å…¥
    @Autowired
    private ExampleService exampleService;
    
    // 2. å…¬å…±æ–¹æ³•
    @GetMapping("/{id}")
    public BaseResponse<ExampleVO> getById(@PathVariable Long id) {
        // 3. å‚æ•°æ ¡éªŒ
        if (id == null || id <= 0) {
            return BaseResponse.error("å‚æ•°é”™è¯¯");
        }
        
        // 4. ä¸šåŠ¡é€»è¾‘
        ExampleVO vo = exampleService.getById(id);
        
        // 5. è¿”å›ç»“æœ
        return BaseResponse.success(vo);
    }
}
```

### 3. æ³¨é‡Šè§„èŒƒ

```java
/**
 * è·å–é¢˜ç›®è¯¦æƒ…
 * 
 * @param id é¢˜ç›®ID
 * @return é¢˜ç›®ä¿¡æ¯
 */
public ProblemVO getProblemById(Long id) {
    // å®ç°ä»£ç 
}
```

### 4. å¼‚å¸¸å¤„ç†

```java
try {
    // ä¸šåŠ¡é€»è¾‘
} catch (Exception e) {
    log.error("æ“ä½œå¤±è´¥", e);
    return BaseResponse.error("æ“ä½œå¤±è´¥ï¼š" + e.getMessage());
}
```

## ğŸ—„ æ•°æ®åº“è®¾è®¡

### è¡¨ç»“æ„

#### questionï¼ˆé¢˜ç›®è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | BIGINT | ä¸»é”® |
| title | VARCHAR(512) | æ ‡é¢˜ |
| content | TEXT | é¢˜ç›®å†…å®¹ï¼ˆMarkdownï¼‰ |
| tags | VARCHAR(256) | æ ‡ç­¾ï¼ˆJSONæ•°ç»„ï¼‰ |
| judge_config | TEXT | åˆ¤é¢˜é…ç½®ï¼ˆJSONï¼‰ |
| judge_case | TEXT | æµ‹è¯•ç”¨ä¾‹ï¼ˆJSONï¼‰ |
| submit_num | INT | æ€»æäº¤æ•° |
| accepted_num | INT | é€šè¿‡æ•° |
| user_id | BIGINT | åˆ›å»ºäººID |
| create_time | DATETIME | åˆ›å»ºæ—¶é—´ |
| update_time | DATETIME | æ›´æ–°æ—¶é—´ |
| is_delete | TINYINT | é€»è¾‘åˆ é™¤ |

#### question_submitï¼ˆæäº¤è®°å½•è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | BIGINT | ä¸»é”® |
| question_id | BIGINT | é¢˜ç›®ID |
| user_id | BIGINT | æäº¤è€…ID |
| language | VARCHAR(128) | ç¼–ç¨‹è¯­è¨€ |
| code | TEXT | ç”¨æˆ·ä»£ç  |
| status | INT | çŠ¶æ€ï¼ˆ0-å¾…åˆ¤é¢˜ï¼Œ1-åˆ¤é¢˜ä¸­ï¼Œ2-æˆåŠŸï¼Œ3-å¤±è´¥ï¼‰ |
| judge_info | TEXT | åˆ¤é¢˜ç»“æœï¼ˆJSONï¼‰ |
| create_time | DATETIME | åˆ›å»ºæ—¶é—´ |

### JSON å­—æ®µæ ¼å¼

#### judge_config

```json
{
  "timeLimit": 1000,
  "memoryLimit": 256
}
```

#### judge_case

```json
[
  {"input": "1 2", "output": "3"},
  {"input": "2 3", "output": "5"}
]
```

#### judge_info

```json
{
  "time": 100,
  "memory": 5000,
  "message": "Accepted"
}
```

## ğŸ”Œ API æ¥å£è§„èŒƒ

### ç»Ÿä¸€å“åº”æ ¼å¼

```java
{
  "code": 200,        // çŠ¶æ€ç ï¼š200-æˆåŠŸï¼Œ500-å¤±è´¥
  "message": "success", // æ¶ˆæ¯
  "data": {}          // æ•°æ®
}
```

### çŠ¶æ€ç è¯´æ˜

- `200`: æˆåŠŸ
- `400`: å‚æ•°é”™è¯¯
- `401`: æœªæˆæƒ
- `403`: æ— æƒé™
- `404`: èµ„æºä¸å­˜åœ¨
- `500`: æœåŠ¡å™¨é”™è¯¯

### æ¥å£ç¤ºä¾‹

#### GET /api/problem/{id}

**è¯·æ±‚å‚æ•°**:
- `id` (path): é¢˜ç›®ID

**å“åº”**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "title": "ä¸¤æ•°ä¹‹å’Œ",
    "content": "...",
    "tags": ["æ•°ç»„", "å“ˆå¸Œè¡¨"],
    "submitNum": 1200,
    "acceptedNum": 856,
    "judgeConfig": {
      "timeLimit": 1000,
      "memoryLimit": 256
    }
  }
}
```

#### POST /api/submit

**è¯·æ±‚ä½“**:
```json
{
  "problemId": 1,
  "code": "public class Solution {...}",
  "language": "java"
}
```

**å“åº”**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "status": 0,
    "judgeInfo": null
  }
}
```

## ğŸ› å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“è¿æ¥å¤±è´¥

- æ£€æŸ¥ MySQL æ˜¯å¦å¯åŠ¨
- æ£€æŸ¥ `application.yml` ä¸­çš„æ•°æ®åº“é…ç½®
- æ£€æŸ¥æ•°æ®åº“ç”¨æˆ·æƒé™

### 2. Redis è¿æ¥å¤±è´¥

- æ£€æŸ¥ Redis æ˜¯å¦å¯åŠ¨
- æ£€æŸ¥ `application.yml` ä¸­çš„ Redis é…ç½®
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### 3. RabbitMQ è¿æ¥å¤±è´¥

- æ£€æŸ¥ RabbitMQ æ˜¯å¦å¯åŠ¨
- æ£€æŸ¥ `application.yml` ä¸­çš„ RabbitMQ é…ç½®
- æ£€æŸ¥è™šæ‹Ÿä¸»æœºè®¾ç½®

### 4. MyBatis Plus æŸ¥è¯¢ä¸åˆ°æ•°æ®

- æ£€æŸ¥å®ä½“ç±»å­—æ®µåæ˜¯å¦ä¸æ•°æ®åº“å­—æ®µåä¸€è‡´
- ä½¿ç”¨ `@TableField` æ³¨è§£æ˜ å°„å­—æ®µ
- æ£€æŸ¥é€»è¾‘åˆ é™¤å­—æ®µé…ç½®

### 5. è·¨åŸŸé—®é¢˜

- å·²é…ç½® `CorsConfig`ï¼Œç¡®ä¿å‰ç«¯è¯·æ±‚åŒ…å«æ­£ç¡®çš„ Origin
- æ£€æŸ¥ `@CrossOrigin` æ³¨è§£é…ç½®

### 6. ç«¯å£è¢«å ç”¨

ä¿®æ”¹ `application.yml` ä¸­çš„ç«¯å£ï¼š

```yaml
server:
  port: 8081  # æ”¹ä¸ºå…¶ä»–ç«¯å£
```

## ğŸ“š å­¦ä¹ èµ„æº

- [Spring Boot å®˜æ–¹æ–‡æ¡£](https://spring.io/projects/spring-boot)
- [MyBatis Plus æ–‡æ¡£](https://baomidou.com/)
- [Redis å®˜æ–¹æ–‡æ¡£](https://redis.io/docs/)
- [RabbitMQ å®˜æ–¹æ–‡æ¡£](https://www.rabbitmq.com/documentation.html)
- [WebSocket æ–‡æ¡£](https://spring.io/guides/gs/messaging-stomp-websocket/)

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [å‰ç«¯å¼€å‘æŒ‡å—](../frontend/å¼€å‘æŒ‡å—.md) - äº†è§£å‰ç«¯æ¥å£è°ƒç”¨
- [é¡¹ç›®è®¾è®¡æ–‡æ¡£](../è®¾è®¡.md) - äº†è§£æ•´ä½“æ¶æ„è®¾è®¡
- [æ•°æ®åº“è®¾è®¡æ–‡æ¡£](./README.md#æ•°æ®åº“è®¾è®¡) - äº†è§£æ•°æ®åº“ç»“æ„

## ğŸ’¡ å¼€å‘å»ºè®®

1. **å…ˆç†è§£ç°æœ‰ä»£ç **ï¼šåœ¨æ·»åŠ æ–°åŠŸèƒ½å‰ï¼Œå…ˆé˜…è¯»ç›¸å…³ä»£ç 
2. **éµå¾ª RESTful è§„èŒƒ**ï¼šè®¾è®¡ API æ—¶éµå¾ª RESTful é£æ ¼
3. **åšå¥½å¼‚å¸¸å¤„ç†**ï¼šæ‰€æœ‰å¯èƒ½å‡ºé”™çš„åœ°æ–¹éƒ½è¦å¤„ç†å¼‚å¸¸
4. **è®°å½•æ—¥å¿—**ï¼šä½¿ç”¨ `log.info()`ã€`log.error()` è®°å½•å…³é”®æ“ä½œ
5. **ç¼–å†™æ³¨é‡Š**ï¼šå¤æ‚é€»è¾‘è¦å†™æ³¨é‡Šè¯´æ˜
6. **å•å…ƒæµ‹è¯•**ï¼šé‡è¦åŠŸèƒ½è¦ç¼–å†™å•å…ƒæµ‹è¯•
7. **ä»£ç å®¡æŸ¥**ï¼šæäº¤å‰è‡ªå·±å…ˆå®¡æŸ¥ä¸€éä»£ç 

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
mvn test
```

### ä½¿ç”¨ Postman æµ‹è¯• API

1. å¯¼å…¥ API é›†åˆï¼ˆå¦‚æœ‰ï¼‰
2. è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆbaseUrl: http://localhost:8080ï¼‰
3. é€ä¸ªæµ‹è¯•æ¥å£

### ä½¿ç”¨ curl æµ‹è¯•

```bash
# è·å–é¢˜ç›®
curl http://localhost:8080/api/problem/1

# æäº¤ä»£ç 
curl -X POST http://localhost:8080/api/submit \
  -H "Content-Type: application/json" \
  -d '{"problemId":1,"code":"public class Solution{}","language":"java"}'
```

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ï¼š
- é¡¹ç›®è´Ÿè´£äººï¼š[å§“å]
- æŠ€æœ¯è®¨è®ºç¾¤ï¼š[ç¾¤å·/é“¾æ¥]

---

**ç¥å¼€å‘æ„‰å¿«ï¼** ğŸ‰

